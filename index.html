<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轨道交通智能照明仪表盘</title>
    <!-- 引入Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Lucide图标库 --><script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.js"></script>
    <script>
        // 确保在DOM加载后替换图标
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
    <style>
        /* 使用Inter字体 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Arial', 'sans-serif';
        }
        
        /* 自定义滑块样式 */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #374151; /* bg-gray-700 */
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #6366f1; /* indigo-500 */
            cursor: pointer;
            transition: background .2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover { background: #818cf8; }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }
        
        /* 自定义开关样式 */
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #374151; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #6366f1; }
        input:checked + .slider:before { transform: translateX(26px); }

        /* 列车模拟样式 */
        .train-container {
            display: flex;
            align-items: center;
            overflow-x: auto;
            padding: 1rem 0;
        }
        .train-loco-body {
            width: 80px;
            height: 60px;
            background-color: #60a5fa; /* blue-400 */
            border-radius: 8px 8px 0 0;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-center;
        }
        .train-loco-window {
            width: 30px;
            height: 20px;
            background-color: #9ca3af; /* gray-400 */
            border-radius: 4px;
        }
        .train-loco-connector {
            width: 15px;
            height: 6px;
            background-color: #6b7280;
        }

        .train-carriage-wrapper {
            display: flex;
            align-items: center;
        }

        .train-carriage {
            width: 140px; /* 宽一点 */
            height: 70px; /* 高一点 */
            background-color: #4b5563; /* 默认暗色 */
            border-radius: 8px;
            box-shadow: 0 0 0px 0px rgba(255, 255, 255, 0); /* 默认无辉光 */
            transition: background-color 0.5s ease, box-shadow 0.5s ease;
            position: relative;
            overflow: hidden; /* 隐藏超出边界的座位 */
            border: 2px solid #374151; /* 边框 */
        }
        .train-carriage-label {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
        }

        .carriage-seats-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
            padding: 5px;
        }

        .seat-row {
            display: flex;
            flex-direction: column;
            gap: 4px; /* 座位间距 */
        }

        .seat {
            width: 12px;
            height: 10px;
            background-color: #a78bfa; /* violet-400 */
            border-radius: 2px;
            opacity: 0.5; /* 默认座位暗一些 */
        }
        
        /* 轨道线 */
        .train-track {
            height: 5px;
            background-color: #4b5563; /* bg-gray-600 */
            width: 100%;
            margin-top: 10px;
            border-radius: 2px;
            position: relative;
        }
        .train-track::before,
        .train-track::after {
            content: '';
            position: absolute;
            height: 10px;
            width: 2px;
            background-color: #6b7280; /* bg-gray-500 */
            top: 50%;
            transform: translateY(-50%);
        }
        .train-track::before { left: 0; }
        .train-track::after { right: 0; }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- 标题栏 --><header class="mb-8 flex items-center justify-center space-x-3">
            <i data-lucide="train-track" class="w-10 h-10 text-indigo-400"></i>
            <h1 class="text-3xl md:text-4xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400">
                轨道交通智能照明仪表盘
            </h1>
        </header>

        <!-- 主网格布局 --><div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- 左侧：控制与场景 --><div class="lg:col-span-1 flex flex-col gap-6">
                
                <!-- 卡片：列车员控制 --><div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                    <h2 class="text-xl font-semibold mb-6 flex items-center">
                        <i data-lucide="toggle-right" class="w-6 h-6 mr-3 text-indigo-400"></i>
                        主控制
                    </h2>
                    
                    <!-- 总开关 --><div class="flex items-center justify-between p-4 bg-gray-900 rounded-lg mb-4">
                        <span class="text-lg font-medium">照明系统总开关</span>
                        <label class="switch">
                            <input type="checkbox" id="master-switch" onchange="toggleSystem()">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <!-- 手动调节 --><div class="p-4 bg-gray-900 rounded-lg mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-lg font-medium">手动调节</span>
                            <span id="manual-slider-value" class="text-lg font-bold text-indigo-400">50%</span>
                        </div>
                        <input type="range" id="manual-slider" min="0" max="100" value="50" class="w-full" oninput="setManualBrightness(this.value)" disabled>
                    </div>
                    
                    <!-- 远程APP模拟 --><div class="p-4 bg-gray-900 rounded-lg">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-lg font-medium">远程APP模拟</span>
                            <i data-lucide="smartphone" class="w-5 h-5"></i>
                        </div>
                        <div class="flex space-x-2">
                            <input type="number" id="app-brightness-input" min="0" max="100" placeholder="亮度 (0-100)" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                            <button id="app-send-btn" onclick="sendAppCommand()" class="px-4 py-2 bg-indigo-600 text-white rounded-md font-semibold hover:bg-indigo-500 transition duration-200 disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>
                                发送
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 卡片：环境模拟 (场景) --><div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                    <h2 class="text-xl font-semibold mb-6 flex items-center">
                        <i data-lucide="gallery-vertical" class="w-6 h-6 mr-3 text-indigo-400"></i>
                        环境模拟 (场景)
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="setEnvironment('sunny')" id="env-sunny" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="sun" class="w-6 h-6 mr-3 text-yellow-400"></i>
                            <span class="font-medium">晴天 ☀️</span>
                        </button>
                        <button onclick="setEnvironment('cloudy')" id="env-cloudy" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="cloud" class="w-6 h-6 mr-3 text-gray-400"></i>
                            <span class="font-medium">阴天 ☁️</span>
                        </button>
                        <button onclick="setEnvironment('rainy')" id="env-rainy" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="cloud-rain" class="w-6 h-6 mr-3 text-blue-400"></i>
                            <span class="font-medium">下雨 🌧️</span>
                        </button>
                        <button onclick="setEnvironment('station')" id="env-station" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="building-2" class="w-6 h-6 mr-3 text-indigo-400"></i>
                            <span class="font-medium">车站 🚉</span>
                        </button>
                        <button onclick="setEnvironment('tunnel')" id="env-tunnel" class="env-btn col-span-2 flex items-center justify-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="chevrons-right" class="w-6 h-6 mr-3 text-gray-500"></i>
                            <span class="font-medium">进入隧道 🚇</span>
                        </button>
                    </div>
                </div>

            </div>

            <!-- 右侧：状态总览 --><div class="lg:col-span-2 bg-gray-800 p-6 rounded-lg shadow-xl">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i data-lucide="layout-dashboard" class="w-6 h-6 mr-3 text-indigo-400"></i>
                    车厢状态总览
                </h2>

                <!-- 状态指标卡 --><div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">系统状态</span>
                        <span id="system-status-text" class="block text-xl font-bold text-red-400">关闭</span>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">当前模式</span>
                        <span id="current-mode-text" class="block text-xl font-bold text-gray-100">-</span>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">灯光总数</span>
                        <span id="total-lights" class="block text-xl font-bold text-indigo-400">240</span>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">估算功耗</span>
                        <span id="power-usage-text" class="block text-xl font-bold text-green-400">0 W</span>
                    </div>
                </div>

                <!-- 亮度条 --><div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-lg font-medium">当前平均亮度</span>
                        <span id="brightness-value" class="text-2xl font-bold text-indigo-400">0%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-4">
                        <div id="brightness-bar" class="bg-gradient-to-r from-indigo-500 to-cyan-400 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- 列车模拟视图 --><div>
                    <h3 class="text-lg font-semibold mb-4">列车模拟视图</h3>
                    <div class="train-container bg-gray-900 rounded-lg w-full">
                        <!-- 车头 --><div class="flex-shrink-0 flex items-center relative">
                            <div class="train-loco-body flex-center">
                                <div class="train-loco-window"></div>
                            </div>
                            <div class="train-loco-connector z-10 -ml-1"></div>
                        </div>
                        
                        <!-- 车厢 (6个) --><div class="train-carriage-wrapper">
                            <!-- Carriage 1 --><div class="train-carriage" data-carriage-id="1">
                                <span class="train-carriage-label">车厢 1</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 2 --><div class="train-carriage" data-carriage-id="2">
                                <span class="train-carriage-label">车厢 2</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 3 --><div class="train-carriage" data-carriage-id="3">
                                <span class="train-carriage-label">车厢 3</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 4 --><div class="train-carriage" data-carriage-id="4">
                                <span class="train-carriage-label">车厢 4</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 5 --><div class="train-carriage" data-carriage-id="5">
                                <span class="train-carriage-label">车厢 5</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 6 --><div class="train-carriage" data-carriage-id="6">
                                <span class="train-carriage-label">车厢 6</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    <div class="train-track"></div>
                </div>

            </div>
        </div>

        <!-- 消息提示框 --><div id="toast-message" class="fixed bottom-8 right-8 bg-green-600 text-white px-6 py-3 rounded-lg shadow-xl opacity-0 translate-y-4 transition-all duration-300">
            指令已发送！
        </div>

    </div>

    <script>
        // 确保在DOM加载后运行脚本
        document.addEventListener('DOMContentLoaded', () => {
            
            // DOM 元素引用
            const brightnessBar = document.getElementById('brightness-bar');
            const brightnessValue = document.getElementById('brightness-value');
            const systemStatusText = document.getElementById('system-status-text');
            const currentModeText = document.getElementById('current-mode-text');
            const powerUsageText = document.getElementById('power-usage-text');
            
            const masterSwitch = document.getElementById('master-switch');
            const manualSlider = document.getElementById('manual-slider');
            const manualSliderValue = document.getElementById('manual-slider-value');
            const appInput = document.getElementById('app-brightness-input');
            const appSendBtn = document.getElementById('app-send-btn');
            const envButtons = document.querySelectorAll('.env-btn');
            const trainCarriages = document.querySelectorAll('.train-carriage');
            const carriageSeats = document.querySelectorAll('.seat'); // 获取所有座位
            const toastMessage = document.getElementById('toast-message');

            // 模拟状态
            let state = {
                isSystemOn: false,
                currentBrightness: 0,
                mode: '-', // '自动', '手动', '远程'
                environment: 'none'
            };

            // 环境光对应的亮度
            const envBrightness = {
                sunny: 30,  // 晴天，亮度不需要太高
                cloudy: 50, // 阴天
                rainy: 60,  // 下雨
                station: 75, // 车站
                tunnel: 90  // 隧道，需要最亮
            };

            // 更新UI的函数
            function updateUI() {
                const brightness = state.currentBrightness;
                const totalLights = 240; // 模拟灯光总数

                // 1. 更新亮度条和数值
                brightnessBar.style.width = `${brightness}%`;
                brightnessValue.textContent = `${brightness}%`;
                
                // 2. 更新车厢灯光模拟 (核心)
                let carriageBgColor, carriageBorderColor, glowColor, seatOpacity;
                if (!state.isSystemOn) {
                    carriageBgColor = 'bg-gray-700'; // 暗
                    carriageBorderColor = 'border-gray-600';
                    glowColor = 'rgba(0, 0, 0, 0)';
                    seatOpacity = 0.5; // 座位半透明
                } else if (brightness < 40) {
                    carriageBgColor = 'bg-yellow-800'; // 弱光
                    carriageBorderColor = 'border-yellow-600';
                    glowColor = `rgba(255, 200, 100, ${brightness / 100 * 0.5})`;
                    seatOpacity = 0.7; // 座位稍亮
                } else if (brightness < 80) {
                    carriageBgColor = 'bg-yellow-600'; // 中光
                    carriageBorderColor = 'border-yellow-400';
                    glowColor = `rgba(255, 220, 130, ${brightness / 100 * 0.7})`;
                    seatOpacity = 0.85; // 座位更亮
                } else {
                    carriageBgColor = 'bg-yellow-400'; // 强光
                    carriageBorderColor = 'border-yellow-200';
                    glowColor = `rgba(255, 240, 180, ${brightness / 100 * 0.9})`;
                    seatOpacity = 1; // 座位完全亮
                }
                
                trainCarriages.forEach(carriage => {
                    // 移除旧样式
                    carriage.className = carriage.className.replace(/bg-\S+/g, '').replace(/border-\S+/g, '');
                    // 添加新样式
                    carriage.classList.add(carriageBgColor, carriageBorderColor);
                    // 添加辉光效果
                    carriage.style.boxShadow = `0 0 15px 5px ${glowColor}`;
                });

                // 更新座位亮度
                carriageSeats.forEach(seat => {
                    seat.style.opacity = seatOpacity;
                });


                // 3. 更新状态指标卡
                if (state.isSystemOn) {
                    systemStatusText.textContent = '运行中';
                    systemStatusText.classList.remove('text-red-400');
                    systemStatusText.classList.add('text-green-400');
                    currentModeText.textContent = state.mode;
                    // 模拟功耗：假设每个灯0.1W/百分比亮度，总共240个灯。 240 * (brightness/100) * 0.1W
                    const powerW = (totalLights * (brightness / 100) * 0.1).toFixed(1);
                    powerUsageText.textContent = `${powerW} W`;
                    
                    // 启用控件
                    manualSlider.disabled = false;
                    appInput.disabled = false;
                    appSendBtn.disabled = false;
                } else {
                    systemStatusText.textContent = '关闭';
                    systemStatusText.classList.remove('text-green-400');
                    systemStatusText.classList.add('text-red-400');
                    currentModeText.textContent = '-';
                    powerUsageText.textContent = '0 W';
                    
                    // 禁用控件
                    manualSlider.disabled = true;
                    appInput.disabled = true;
                    appSendBtn.disabled = true;
                }
                
                // 4. 更新环境按钮高亮
                envButtons.forEach(btn => {
                    if (btn.id === `env-${state.environment}`) {
                        btn.classList.add('border-indigo-500', 'bg-gray-600');
                    } else {
                        btn.classList.remove('border-indigo-500', 'bg-gray-600');
                    }
                });
                
                // 5. 更新手动滑块
                if(state.mode === '手动' || state.mode === '远程') {
                    manualSlider.value = brightness;
                }
                manualSliderValue.textContent = `${brightness}%`;
            }

            // 总开关控制
            window.toggleSystem = function() {
                state.isSystemOn = masterSwitch.checked;
                if (state.isSystemOn) {
                    // 如果刚打开，默认进入上一个环境的自动模式
                    state.environment = 'sunny'; // 默认开启为晴天
                    state.mode = '自动';
                    state.currentBrightness = envBrightness[state.environment];
                } else {
                    // 关闭系统
                    state.currentBrightness = 0;
                    state.mode = '-';
                    state.environment = 'none';
                }
                updateUI();
            }

            // 环境模拟控制
            window.setEnvironment = function(env) {
                if (!state.isSystemOn) return; // 系统关闭时无效
                
                state.mode = '自动';
                state.environment = env;
                state.currentBrightness = envBrightness[env];
                updateUI();
            }

            // 手动滑块控制
            window.setManualBrightness = function(value) {
                if (!state.isSystemOn) return; // 系统关闭时无效
                
                state.mode = '手动';
                state.environment = 'none'; // 手动模式下取消环境高亮
                state.currentBrightness = parseInt(value, 10);
                updateUI();
            }

            // APP模拟发送
            window.sendAppCommand = function() {
                if (!state.isSystemOn) return; // 系统关闭时无效
                
                let value = parseInt(appInput.value, 10);
                if (isNaN(value) || value < 0 || value > 100) {
                    showToast('请输入0-100的有效值！', 'error');
                    return;
                }
                
                state.mode = '远程';
                state.environment = 'none';
                state.currentBrightness = value;
                appInput.value = ''; // 清空输入框
                updateUI();
                showToast('远程指令已发送！');
            }
            
            // 消息提示
            function showToast(message, type = 'success') {
                toastMessage.textContent = message;
                if(type === 'error') {
                    toastMessage.classList.remove('bg-green-600');
                    toastMessage.classList.add('bg-red-600');
                } else {
                    toastMessage.classList.remove('bg-red-600');
                    toastMessage.classList.add('bg-green-600');
                }
                
                toastMessage.classList.remove('opacity-0', 'translate-y-4');
                toastMessage.classList.add('opacity-100', 'translate-y-0');

                setTimeout(() => {
                    toastMessage.classList.remove('opacity-100', 'translate-y-0');
                    toastMessage.classList.add('opacity-0', 'translate-y-4');
                }, 3000);
            }

            // 初始化
            updateUI();
            lucide.createIcons(); // 确保图标被渲染
        });
    </script>
</body>
</html>

