<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½¨é“äº¤é€šæ™ºèƒ½ç…§æ˜ä»ªè¡¨ç›˜</title>
    <!-- å¼•å…¥Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Lucideå›¾æ ‡åº“ --><script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.js"></script>
    <script>
        // ç¡®ä¿åœ¨DOMåŠ è½½åæ›¿æ¢å›¾æ ‡
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
    <style>
        /* ä½¿ç”¨Interå­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Arial', 'sans-serif';
        }
        
        /* è‡ªå®šä¹‰æ»‘å—æ ·å¼ */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #374151; /* bg-gray-700 */
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #6366f1; /* indigo-500 */
            cursor: pointer;
            transition: background .2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover { background: #818cf8; }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }
        
        /* è‡ªå®šä¹‰å¼€å…³æ ·å¼ */
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #374151; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #6366f1; }
        input:checked + .slider:before { transform: translateX(26px); }

        /* åˆ—è½¦æ¨¡æ‹Ÿæ ·å¼ */
        .train-container {
            display: flex;
            align-items: center;
            overflow-x: auto;
            padding: 1rem 0;
        }
        .train-loco-body {
            width: 80px;
            height: 60px;
            background-color: #60a5fa; /* blue-400 */
            border-radius: 8px 8px 0 0;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-center;
        }
        .train-loco-window {
            width: 30px;
            height: 20px;
            background-color: #9ca3af; /* gray-400 */
            border-radius: 4px;
        }
        .train-loco-connector {
            width: 15px;
            height: 6px;
            background-color: #6b7280;
        }

        .train-carriage-wrapper {
            display: flex;
            align-items: center;
        }

        .train-carriage {
            width: 140px; /* å®½ä¸€ç‚¹ */
            height: 70px; /* é«˜ä¸€ç‚¹ */
            background-color: #4b5563; /* é»˜è®¤æš—è‰² */
            border-radius: 8px;
            box-shadow: 0 0 0px 0px rgba(255, 255, 255, 0); /* é»˜è®¤æ— è¾‰å…‰ */
            transition: background-color 0.5s ease, box-shadow 0.5s ease;
            position: relative;
            overflow: hidden; /* éšè—è¶…å‡ºè¾¹ç•Œçš„åº§ä½ */
            border: 2px solid #374151; /* è¾¹æ¡† */
        }
        .train-carriage-label {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
        }

        .carriage-seats-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
            padding: 5px;
        }

        .seat-row {
            display: flex;
            flex-direction: column;
            gap: 4px; /* åº§ä½é—´è· */
        }

        .seat {
            width: 12px;
            height: 10px;
            background-color: #a78bfa; /* violet-400 */
            border-radius: 2px;
            opacity: 0.5; /* é»˜è®¤åº§ä½æš—ä¸€äº› */
        }
        
        /* è½¨é“çº¿ */
        .train-track {
            height: 5px;
            background-color: #4b5563; /* bg-gray-600 */
            width: 100%;
            margin-top: 10px;
            border-radius: 2px;
            position: relative;
        }
        .train-track::before,
        .train-track::after {
            content: '';
            position: absolute;
            height: 10px;
            width: 2px;
            background-color: #6b7280; /* bg-gray-500 */
            top: 50%;
            transform: translateY(-50%);
        }
        .train-track::before { left: 0; }
        .train-track::after { right: 0; }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- æ ‡é¢˜æ  --><header class="mb-8 flex items-center justify-center space-x-3">
            <i data-lucide="train-track" class="w-10 h-10 text-indigo-400"></i>
            <h1 class="text-3xl md:text-4xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400">
                è½¨é“äº¤é€šæ™ºèƒ½ç…§æ˜ä»ªè¡¨ç›˜
            </h1>
        </header>

        <!-- ä¸»ç½‘æ ¼å¸ƒå±€ --><div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- å·¦ä¾§ï¼šæ§åˆ¶ä¸åœºæ™¯ --><div class="lg:col-span-1 flex flex-col gap-6">
                
                <!-- å¡ç‰‡ï¼šåˆ—è½¦å‘˜æ§åˆ¶ --><div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                    <h2 class="text-xl font-semibold mb-6 flex items-center">
                        <i data-lucide="toggle-right" class="w-6 h-6 mr-3 text-indigo-400"></i>
                        ä¸»æ§åˆ¶
                    </h2>
                    
                    <!-- æ€»å¼€å…³ --><div class="flex items-center justify-between p-4 bg-gray-900 rounded-lg mb-4">
                        <span class="text-lg font-medium">ç…§æ˜ç³»ç»Ÿæ€»å¼€å…³</span>
                        <label class="switch">
                            <input type="checkbox" id="master-switch" onchange="toggleSystem()">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <!-- æ‰‹åŠ¨è°ƒèŠ‚ --><div class="p-4 bg-gray-900 rounded-lg mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-lg font-medium">æ‰‹åŠ¨è°ƒèŠ‚</span>
                            <span id="manual-slider-value" class="text-lg font-bold text-indigo-400">50%</span>
                        </div>
                        <input type="range" id="manual-slider" min="0" max="100" value="50" class="w-full" oninput="setManualBrightness(this.value)" disabled>
                    </div>
                    
                    <!-- è¿œç¨‹APPæ¨¡æ‹Ÿ --><div class="p-4 bg-gray-900 rounded-lg">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-lg font-medium">è¿œç¨‹APPæ¨¡æ‹Ÿ</span>
                            <i data-lucide="smartphone" class="w-5 h-5"></i>
                        </div>
                        <div class="flex space-x-2">
                            <input type="number" id="app-brightness-input" min="0" max="100" placeholder="äº®åº¦ (0-100)" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                            <button id="app-send-btn" onclick="sendAppCommand()" class="px-4 py-2 bg-indigo-600 text-white rounded-md font-semibold hover:bg-indigo-500 transition duration-200 disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>
                                å‘é€
                            </button>
                        </div>
                    </div>
                </div>

                <!-- å¡ç‰‡ï¼šç¯å¢ƒæ¨¡æ‹Ÿ (åœºæ™¯) --><div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                    <h2 class="text-xl font-semibold mb-6 flex items-center">
                        <i data-lucide="gallery-vertical" class="w-6 h-6 mr-3 text-indigo-400"></i>
                        ç¯å¢ƒæ¨¡æ‹Ÿ (åœºæ™¯)
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="setEnvironment('sunny')" id="env-sunny" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="sun" class="w-6 h-6 mr-3 text-yellow-400"></i>
                            <span class="font-medium">æ™´å¤© â˜€ï¸</span>
                        </button>
                        <button onclick="setEnvironment('cloudy')" id="env-cloudy" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="cloud" class="w-6 h-6 mr-3 text-gray-400"></i>
                            <span class="font-medium">é˜´å¤© â˜ï¸</span>
                        </button>
                        <button onclick="setEnvironment('rainy')" id="env-rainy" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="cloud-rain" class="w-6 h-6 mr-3 text-blue-400"></i>
                            <span class="font-medium">ä¸‹é›¨ ğŸŒ§ï¸</span>
                        </button>
                        <button onclick="setEnvironment('station')" id="env-station" class="env-btn flex items-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="building-2" class="w-6 h-6 mr-3 text-indigo-400"></i>
                            <span class="font-medium">è½¦ç«™ ğŸš‰</span>
                        </button>
                        <button onclick="setEnvironment('tunnel')" id="env-tunnel" class="env-btn col-span-2 flex items-center justify-center p-4 bg-gray-700 rounded-lg shadow-md hover:bg-gray-600 transition duration-200 border-2 border-transparent">
                            <i data-lucide="chevrons-right" class="w-6 h-6 mr-3 text-gray-500"></i>
                            <span class="font-medium">è¿›å…¥éš§é“ ğŸš‡</span>
                        </button>
                    </div>
                </div>

            </div>

            <!-- å³ä¾§ï¼šçŠ¶æ€æ€»è§ˆ --><div class="lg:col-span-2 bg-gray-800 p-6 rounded-lg shadow-xl">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i data-lucide="layout-dashboard" class="w-6 h-6 mr-3 text-indigo-400"></i>
                    è½¦å¢çŠ¶æ€æ€»è§ˆ
                </h2>

                <!-- çŠ¶æ€æŒ‡æ ‡å¡ --><div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">ç³»ç»ŸçŠ¶æ€</span>
                        <span id="system-status-text" class="block text-xl font-bold text-red-400">å…³é—­</span>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">å½“å‰æ¨¡å¼</span>
                        <span id="current-mode-text" class="block text-xl font-bold text-gray-100">-</span>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">ç¯å…‰æ€»æ•°</span>
                        <span id="total-lights" class="block text-xl font-bold text-indigo-400">240</span>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg shadow-inner text-center">
                        <span class="text-sm text-gray-400 font-medium">ä¼°ç®—åŠŸè€—</span>
                        <span id="power-usage-text" class="block text-xl font-bold text-green-400">0 W</span>
                    </div>
                </div>

                <!-- äº®åº¦æ¡ --><div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-lg font-medium">å½“å‰å¹³å‡äº®åº¦</span>
                        <span id="brightness-value" class="text-2xl font-bold text-indigo-400">0%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-4">
                        <div id="brightness-bar" class="bg-gradient-to-r from-indigo-500 to-cyan-400 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- åˆ—è½¦æ¨¡æ‹Ÿè§†å›¾ --><div>
                    <h3 class="text-lg font-semibold mb-4">åˆ—è½¦æ¨¡æ‹Ÿè§†å›¾</h3>
                    <div class="train-container bg-gray-900 rounded-lg w-full">
                        <!-- è½¦å¤´ --><div class="flex-shrink-0 flex items-center relative">
                            <div class="train-loco-body flex-center">
                                <div class="train-loco-window"></div>
                            </div>
                            <div class="train-loco-connector z-10 -ml-1"></div>
                        </div>
                        
                        <!-- è½¦å¢ (6ä¸ª) --><div class="train-carriage-wrapper">
                            <!-- Carriage 1 --><div class="train-carriage" data-carriage-id="1">
                                <span class="train-carriage-label">è½¦å¢ 1</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 2 --><div class="train-carriage" data-carriage-id="2">
                                <span class="train-carriage-label">è½¦å¢ 2</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 3 --><div class="train-carriage" data-carriage-id="3">
                                <span class="train-carriage-label">è½¦å¢ 3</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 4 --><div class="train-carriage" data-carriage-id="4">
                                <span class="train-carriage-label">è½¦å¢ 4</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 5 --><div class="train-carriage" data-carriage-id="5">
                                <span class="train-carriage-label">è½¦å¢ 5</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="train-loco-connector -ml-1"></div>

                            <!-- Carriage 6 --><div class="train-carriage" data-carriage-id="6">
                                <span class="train-carriage-label">è½¦å¢ 6</span>
                                <div class="carriage-seats-container">
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                    <div class="seat-row">
                                        <div class="seat"></div><div class="seat"></div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    <div class="train-track"></div>
                </div>

            </div>
        </div>

        <!-- æ¶ˆæ¯æç¤ºæ¡† --><div id="toast-message" class="fixed bottom-8 right-8 bg-green-600 text-white px-6 py-3 rounded-lg shadow-xl opacity-0 translate-y-4 transition-all duration-300">
            æŒ‡ä»¤å·²å‘é€ï¼
        </div>

    </div>

    <script>
        // ç¡®ä¿åœ¨DOMåŠ è½½åè¿è¡Œè„šæœ¬
        document.addEventListener('DOMContentLoaded', () => {
            
            // DOM å…ƒç´ å¼•ç”¨
            const brightnessBar = document.getElementById('brightness-bar');
            const brightnessValue = document.getElementById('brightness-value');
            const systemStatusText = document.getElementById('system-status-text');
            const currentModeText = document.getElementById('current-mode-text');
            const powerUsageText = document.getElementById('power-usage-text');
            
            const masterSwitch = document.getElementById('master-switch');
            const manualSlider = document.getElementById('manual-slider');
            const manualSliderValue = document.getElementById('manual-slider-value');
            const appInput = document.getElementById('app-brightness-input');
            const appSendBtn = document.getElementById('app-send-btn');
            const envButtons = document.querySelectorAll('.env-btn');
            const trainCarriages = document.querySelectorAll('.train-carriage');
            const carriageSeats = document.querySelectorAll('.seat'); // è·å–æ‰€æœ‰åº§ä½
            const toastMessage = document.getElementById('toast-message');

            // æ¨¡æ‹ŸçŠ¶æ€
            let state = {
                isSystemOn: false,
                currentBrightness: 0,
                mode: '-', // 'è‡ªåŠ¨', 'æ‰‹åŠ¨', 'è¿œç¨‹'
                environment: 'none'
            };

            // ç¯å¢ƒå…‰å¯¹åº”çš„äº®åº¦
            const envBrightness = {
                sunny: 30,  // æ™´å¤©ï¼Œäº®åº¦ä¸éœ€è¦å¤ªé«˜
                cloudy: 50, // é˜´å¤©
                rainy: 60,  // ä¸‹é›¨
                station: 75, // è½¦ç«™
                tunnel: 90  // éš§é“ï¼Œéœ€è¦æœ€äº®
            };

            // æ›´æ–°UIçš„å‡½æ•°
            function updateUI() {
                const brightness = state.currentBrightness;
                const totalLights = 240; // æ¨¡æ‹Ÿç¯å…‰æ€»æ•°

                // 1. æ›´æ–°äº®åº¦æ¡å’Œæ•°å€¼
                brightnessBar.style.width = `${brightness}%`;
                brightnessValue.textContent = `${brightness}%`;
                
                // 2. æ›´æ–°è½¦å¢ç¯å…‰æ¨¡æ‹Ÿ (æ ¸å¿ƒ)
                let carriageBgColor, carriageBorderColor, glowColor, seatOpacity;
                if (!state.isSystemOn) {
                    carriageBgColor = 'bg-gray-700'; // æš—
                    carriageBorderColor = 'border-gray-600';
                    glowColor = 'rgba(0, 0, 0, 0)';
                    seatOpacity = 0.5; // åº§ä½åŠé€æ˜
                } else if (brightness < 40) {
                    carriageBgColor = 'bg-yellow-800'; // å¼±å…‰
                    carriageBorderColor = 'border-yellow-600';
                    glowColor = `rgba(255, 200, 100, ${brightness / 100 * 0.5})`;
                    seatOpacity = 0.7; // åº§ä½ç¨äº®
                } else if (brightness < 80) {
                    carriageBgColor = 'bg-yellow-600'; // ä¸­å…‰
                    carriageBorderColor = 'border-yellow-400';
                    glowColor = `rgba(255, 220, 130, ${brightness / 100 * 0.7})`;
                    seatOpacity = 0.85; // åº§ä½æ›´äº®
                } else {
                    carriageBgColor = 'bg-yellow-400'; // å¼ºå…‰
                    carriageBorderColor = 'border-yellow-200';
                    glowColor = `rgba(255, 240, 180, ${brightness / 100 * 0.9})`;
                    seatOpacity = 1; // åº§ä½å®Œå…¨äº®
                }
                
                trainCarriages.forEach(carriage => {
                    // ç§»é™¤æ—§æ ·å¼
                    carriage.className = carriage.className.replace(/bg-\S+/g, '').replace(/border-\S+/g, '');
                    // æ·»åŠ æ–°æ ·å¼
                    carriage.classList.add(carriageBgColor, carriageBorderColor);
                    // æ·»åŠ è¾‰å…‰æ•ˆæœ
                    carriage.style.boxShadow = `0 0 15px 5px ${glowColor}`;
                });

                // æ›´æ–°åº§ä½äº®åº¦
                carriageSeats.forEach(seat => {
                    seat.style.opacity = seatOpacity;
                });


                // 3. æ›´æ–°çŠ¶æ€æŒ‡æ ‡å¡
                if (state.isSystemOn) {
                    systemStatusText.textContent = 'è¿è¡Œä¸­';
                    systemStatusText.classList.remove('text-red-400');
                    systemStatusText.classList.add('text-green-400');
                    currentModeText.textContent = state.mode;
                    // æ¨¡æ‹ŸåŠŸè€—ï¼šå‡è®¾æ¯ä¸ªç¯0.1W/ç™¾åˆ†æ¯”äº®åº¦ï¼Œæ€»å…±240ä¸ªç¯ã€‚ 240 * (brightness/100) * 0.1W
                    const powerW = (totalLights * (brightness / 100) * 0.1).toFixed(1);
                    powerUsageText.textContent = `${powerW} W`;
                    
                    // å¯ç”¨æ§ä»¶
                    manualSlider.disabled = false;
                    appInput.disabled = false;
                    appSendBtn.disabled = false;
                } else {
                    systemStatusText.textContent = 'å…³é—­';
                    systemStatusText.classList.remove('text-green-400');
                    systemStatusText.classList.add('text-red-400');
                    currentModeText.textContent = '-';
                    powerUsageText.textContent = '0 W';
                    
                    // ç¦ç”¨æ§ä»¶
                    manualSlider.disabled = true;
                    appInput.disabled = true;
                    appSendBtn.disabled = true;
                }
                
                // 4. æ›´æ–°ç¯å¢ƒæŒ‰é’®é«˜äº®
                envButtons.forEach(btn => {
                    if (btn.id === `env-${state.environment}`) {
                        btn.classList.add('border-indigo-500', 'bg-gray-600');
                    } else {
                        btn.classList.remove('border-indigo-500', 'bg-gray-600');
                    }
                });
                
                // 5. æ›´æ–°æ‰‹åŠ¨æ»‘å—
                if(state.mode === 'æ‰‹åŠ¨' || state.mode === 'è¿œç¨‹') {
                    manualSlider.value = brightness;
                }
                manualSliderValue.textContent = `${brightness}%`;
            }

            // æ€»å¼€å…³æ§åˆ¶
            window.toggleSystem = function() {
                state.isSystemOn = masterSwitch.checked;
                if (state.isSystemOn) {
                    // å¦‚æœåˆšæ‰“å¼€ï¼Œé»˜è®¤è¿›å…¥ä¸Šä¸€ä¸ªç¯å¢ƒçš„è‡ªåŠ¨æ¨¡å¼
                    state.environment = 'sunny'; // é»˜è®¤å¼€å¯ä¸ºæ™´å¤©
                    state.mode = 'è‡ªåŠ¨';
                    state.currentBrightness = envBrightness[state.environment];
                } else {
                    // å…³é—­ç³»ç»Ÿ
                    state.currentBrightness = 0;
                    state.mode = '-';
                    state.environment = 'none';
                }
                updateUI();
            }

            // ç¯å¢ƒæ¨¡æ‹Ÿæ§åˆ¶
            window.setEnvironment = function(env) {
                if (!state.isSystemOn) return; // ç³»ç»Ÿå…³é—­æ—¶æ— æ•ˆ
                
                state.mode = 'è‡ªåŠ¨';
                state.environment = env;
                state.currentBrightness = envBrightness[env];
                updateUI();
            }

            // æ‰‹åŠ¨æ»‘å—æ§åˆ¶
            window.setManualBrightness = function(value) {
                if (!state.isSystemOn) return; // ç³»ç»Ÿå…³é—­æ—¶æ— æ•ˆ
                
                state.mode = 'æ‰‹åŠ¨';
                state.environment = 'none'; // æ‰‹åŠ¨æ¨¡å¼ä¸‹å–æ¶ˆç¯å¢ƒé«˜äº®
                state.currentBrightness = parseInt(value, 10);
                updateUI();
            }

            // APPæ¨¡æ‹Ÿå‘é€
            window.sendAppCommand = function() {
                if (!state.isSystemOn) return; // ç³»ç»Ÿå…³é—­æ—¶æ— æ•ˆ
                
                let value = parseInt(appInput.value, 10);
                if (isNaN(value) || value < 0 || value > 100) {
                    showToast('è¯·è¾“å…¥0-100çš„æœ‰æ•ˆå€¼ï¼', 'error');
                    return;
                }
                
                state.mode = 'è¿œç¨‹';
                state.environment = 'none';
                state.currentBrightness = value;
                appInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                updateUI();
                showToast('è¿œç¨‹æŒ‡ä»¤å·²å‘é€ï¼');
            }
            
            // æ¶ˆæ¯æç¤º
            function showToast(message, type = 'success') {
                toastMessage.textContent = message;
                if(type === 'error') {
                    toastMessage.classList.remove('bg-green-600');
                    toastMessage.classList.add('bg-red-600');
                } else {
                    toastMessage.classList.remove('bg-red-600');
                    toastMessage.classList.add('bg-green-600');
                }
                
                toastMessage.classList.remove('opacity-0', 'translate-y-4');
                toastMessage.classList.add('opacity-100', 'translate-y-0');

                setTimeout(() => {
                    toastMessage.classList.remove('opacity-100', 'translate-y-0');
                    toastMessage.classList.add('opacity-0', 'translate-y-4');
                }, 3000);
            }

            // åˆå§‹åŒ–
            updateUI();
            lucide.createIcons(); // ç¡®ä¿å›¾æ ‡è¢«æ¸²æŸ“
        });
    </script>
</body>
</html>

